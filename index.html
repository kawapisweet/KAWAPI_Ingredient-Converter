<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <!-- 關鍵：禁止使用者縮放並設定 viewport，優化手機體驗 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KAWAPI 烘焙食材換算</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f5f5f4; /* Stone-100 */
            color: #44403c; /* Stone-700 */
            /* 防止 iOS 點擊時產生高亮背景 */
            -webkit-tap-highlight-color: transparent;
        }

        /* 自定義捲軸 (美化) */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px; /* 手機版改細一點 */
        }
        @media (min-width: 768px) {
            .custom-scrollbar::-webkit-scrollbar {
                width: 6px;
            }
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f5f5f4;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d6d3d1;
            border-radius: 10px;
        }

        /* 移除數字輸入框的箭頭 */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* 資料夾動畫 */
        .folder-content {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .folder-content.open {
            max-height: 1000px; /* 增加高度以免內容被切掉 */
            opacity: 1;
        }
        .folder-header.active {
            background-color: #e7e5e4;
        }

        /* Instagram 彩虹框動畫效果 */
        .ig-gradient-border {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        }
    </style>
</head>
<body class="min-h-screen py-6 px-3 md:px-8 flex flex-col">

    <div class="max-w-6xl mx-auto w-full flex-grow">
        <!-- Header -->
        <header class="text-center mb-6 md:mb-10">
            <h1 class="text-2xl md:text-4xl font-bold text-stone-700 tracking-wider mb-1 flex items-center justify-center">
                <i class="fa-solid fa-cookie-bite mr-2 text-stone-500 text-xl md:text-3xl"></i>
                KAWAPI 食材份量換算機
            </h1>
            <p class="text-stone-400 text-xs md:text-sm tracking-widest uppercase">Ingredient Converter Calculator</p>
        </header>

        <!-- Main Grid Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Left Column: Original Recipe -->
            <div class="bg-white rounded-3xl shadow-lg overflow-hidden border border-stone-200 flex flex-col h-[600px] lg:h-auto relative">

                <!-- 1. Recipe Menu (Scrollable) -->
                <div class="p-3 bg-stone-50 border-b border-stone-200 h-[35%] overflow-y-auto custom-scrollbar">
                    <h2 class="text-xs font-bold text-stone-400 uppercase tracking-widest mb-2 sticky top-0 bg-stone-50 py-1 z-10">
                      <i class="fa-solid fa-bars mr-1"></i>食譜選單
                    </h2>
                    <!-- 手機版單欄，桌機版雙欄，更節省空間 -->
                    <div id="recipe-menu-container" class="grid grid-cols-1 md:grid-cols-2 gap-2 items-start">
                        <!-- Menu injected by JS -->
                    </div>
                </div>

                <!-- 2. Video Link -->
                <div class="px-4 py-3 bg-white border-b border-stone-200 shrink-0">
                    <a id="video-link" href="#" target="_blank" class="block w-full text-center py-2.5 rounded-xl bg-stone-700 text-stone-100 hover:bg-red-600 transition-all font-bold shadow-sm group text-sm">
                        <i class="fa-brands fa-youtube text-lg mr-2 group-hover:scale-110 transition-transform"></i>
                        觀看食譜教學影片
                    </a>
                </div>

                <!-- 3. Ingredients List -->
                <div class="p-5 bg-white flex-grow overflow-y-auto custom-scrollbar relative">
                    <div class="flex items-start justify-between mb-4 border-b border-stone-200 pb-3">
                        <div class="pr-2">
                            <div class="text-[10px] text-stone-400" id="display-category-name">分類</div>
                            <h3 class="font-bold text-stone-700 text-lg" id="display-recipe-name">載入中...</h3>
                        </div>
                        <div class="text-right min-w-[80px]">
                            <div class="text-[10px] text-stone-400">原食譜模具大小</div>
                            <div class="font-bold text-stone-700 text-lg" id="original-mold-info">--</div>
                        </div>
                    </div>

                    <ul id="original-ingredient-list" class="space-y-2 text-stone-600 text-sm">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>

            <!-- Right Column: Converter (放在上面 order-1 手機優先看到輸入框) -->
            <div class="bg-[#e7e5e4] rounded-3xl shadow-lg border border-stone-300 p-5 md:p-8 flex flex-col h-auto lg:h-full relative">
                <div class="absolute top-0 right-0 bg-stone-600 text-white text-xs font-bold px-3 py-1 rounded-bl-xl rounded-tr-2xl">
                    換算區
                </div>

                <!-- Step 1: Mold Shape -->
                <div class="mb-5">
                    <h2 class="text-base font-bold text-stone-700 mb-3 flex items-center">
                        <span class="w-6 h-6 rounded-full bg-stone-300 flex items-center justify-center mr-2 text-stone-600 text-xs shadow-sm">1</span>
                        選擇使用的模具形狀
                    </h2>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="setTargetShape('circle')" id="btn-target-circle" class="p-3 rounded-xl border-2 border-stone-400 bg-white/80 text-stone-700 font-bold transition-all flex flex-col items-center gap-1 shadow-sm">
                            <i class="fa-regular fa-circle text-xl"></i>
                            <span class="text-sm">圓形</span>
                        </button>
                        <button onclick="setTargetShape('square')" id="btn-target-square" class="p-3 rounded-xl border-2 border-transparent bg-white/50 text-stone-500 hover:bg-white/80 transition-all flex flex-col items-center gap-1">
                            <i class="fa-regular fa-square text-xl"></i>
                            <span class="text-sm">方形</span>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Input -->
                <div class="mb-5 bg-white/90 rounded-2xl p-4 border border-stone-200 shadow-sm">
                    <h2 class="text-base font-bold text-stone-700 mb-2 flex items-center">
                        <span class="w-6 h-6 rounded-full bg-stone-300 flex items-center justify-center mr-2 text-stone-600 text-xs shadow-sm">2</span>
                        輸入尺寸 (cm)
                    </h2>

                    <!-- Input Container -->
                    <div id="input-container" class="pl-8">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Results Area -->
                <div class="flex-grow bg-stone-700 rounded-2xl p-5 text-stone-100 shadow-inner border border-stone-600 min-h-[250px] flex flex-col">
                    <div class="flex justify-between items-end mb-4 border-b border-stone-500 pb-3 shrink-0">
                        <div>
                            <div class="text-[10px] text-stone-400 uppercase tracking-widest mb-0.5">Ratio</div>
                            <div class="text-2xl font-bold text-orange-100 leading-none" id="result-ratio">1.00x</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-medium text-stone-300">換算結果</div>
                        </div>
                    </div>

                    <div class="overflow-y-auto custom-scrollbar flex-grow pr-1">
                        <ul id="result-ingredient-list" class="space-y-3 text-base">
                            <li class="text-center text-stone-500 py-8 text-sm">請輸入上方尺寸以計算</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Social Media Section (Updated) -->
        <section class="mt-10 mb-6 border-t border-stone-300 pt-8">

            <!-- IG Avatar & Header Link Container -->
            <div class="flex flex-col items-center justify-center mb-6 cursor-pointer group" onclick="window.open('https://www.instagram.com/kawapi_chu/', '_blank')">
                <div class="flex items-center gap-4 relative">
                    <!-- IG Avatar with Gradient Border -->
                    <div class="relative w-16 h-16 md:w-20 md:h-20 rounded-full p-[3px] ig-gradient-border shadow-md group-hover:scale-105 transition-transform duration-300">
                        <!-- 請將下方的 src 換成您真實的頭像網址 -->
                        <img src="https://ugc.production.linktr.ee/4c6bc3fd-5376-4b00-aaa9-ccaa2995ff1b_467507587-956318039870144-6872184301590510822-n.jpeg?io=true&size=avatar-v3_0"
                             alt="kawapi_chu"
                             class="w-full h-full rounded-full object-cover border-2 border-white bg-white">

                        <!-- Optional: Plus Icon or Notification dot -->
                        <div class="absolute bottom-0 right-0 bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-[10px] border-2 border-white shadow-sm">
                            <i class="fa-solid fa-plus"></i>
                        </div>
                    </div>

                    <!-- Text -->
                    <div class="text-left">
                        <h3 class="text-base md:text-lg font-bold text-stone-600 group-hover:text-pink-600 transition-colors">
                            <i class="fa-brands fa-instagram mr-1"></i>點擊追蹤KAWAPI
                        </h3>
                        <p class="text-xs text-stone-400 mt-1 group-hover:text-stone-500">
                            最新食譜＆團購優惠免費拿
                        </p>
                    </div>
                </div>
            </div>

            <!-- Social Links Grid -->
            <div class="grid grid-cols-2 md:flex md:flex-wrap justify-center gap-3 px-2">
                <!-- Instagram -->
                <a href="https://www.instagram.com/kawapi_chu/" target="_blank" class="social-btn flex flex-col md:flex-row items-center justify-center gap-2 px-3 py-3 bg-white border border-stone-200 rounded-2xl text-stone-600 hover:text-pink-600 hover:border-pink-300 shadow-sm transition-all">
                    <i class="fa-brands fa-instagram text-xl"></i>
                    <span class="font-medium text-xs md:text-sm">最新食譜</span>
                </a>

                <!-- YouTube -->
                <a href="https://www.youtube.com/@kawapi_sweet" target="_blank" class="social-btn flex flex-col md:flex-row items-center justify-center gap-2 px-3 py-3 bg-white border border-stone-200 rounded-2xl text-stone-600 hover:text-red-600 hover:border-red-300 shadow-sm transition-all">
                    <i class="fa-brands fa-youtube text-xl"></i>
                    <span class="font-medium text-xs md:text-sm">食譜影片教學</span>
                </a>

                <!-- Linktree -->
                <a href="https://linktr.ee/kawapi" target="_blank" class="social-btn flex flex-col md:flex-row items-center justify-center gap-2 px-3 py-3 bg-white border border-stone-200 rounded-2xl text-stone-600 hover:text-green-600 hover:border-green-300 shadow-sm transition-all col-span-2 md:col-span-1">
                    <i class="fa-solid fa-link text-xl"></i>
                    <span class="font-medium text-xs md:text-sm">烘焙小物｜開團優惠</span>
                </a>
            </div>

            <div class="grid grid-cols-2 md:flex md:flex-wrap justify-center gap-3 mt-3 px-2">
                <!-- Vocus Links -->
                <a href="https://vocus.cc/salon/kawapi/room/6916afedcebbddbc5cd9558d" target="_blank" class="social-btn flex flex-col md:flex-row items-center justify-center gap-2 px-3 py-3 bg-white border border-stone-200 rounded-2xl text-stone-600 hover:text-blue-600 hover:border-blue-300 shadow-sm transition-all">
                    <i class="fa-solid fa-thumbs-up text-xl"></i>
                    <span class="font-medium text-xs md:text-sm">烘焙小技巧</span>
                </a>
                <a href="https://vocus.cc/salon/kawapi/room/68f8640c87172142058bc46f" target="_blank" class="social-btn flex flex-col md:flex-row items-center justify-center gap-2 px-3 py-3 bg-white border border-stone-200 rounded-2xl text-stone-600 hover:text-blue-600 hover:border-blue-300 shadow-sm transition-all">
                    <i class="fa-solid fa-location-dot text-xl"></i>
                    <span class="font-medium text-xs md:text-sm">日本生活</span>
                </a>

                <a href="https://vocus.cc/article/68f88546fd897800010d5b39" target="_blank" class="social-btn flex flex-col md:flex-row items-center justify-center gap-2 px-3 py-3 bg-white border border-stone-200 rounded-2xl text-stone-600 hover:text-blue-600 hover:border-blue-300 shadow-sm transition-all col-span-2 md:col-span-1">
                    <i class="fa-solid fa-carrot text-xl"></i>
                    <span class="font-medium text-xs md:text-sm">日本地瓜研究（持續更新中）</span>
                </a>
            </div>
        </section>

        <footer class="text-center text-stone-400 text-[10px] pb-6">
            <p>© kawapi_chu | Ingredient Converter</p>
        </footer>
    </div>

    <script>
        // =========================================================================
        // 【食譜資料庫區】
        // =========================================================================

        const recipeData = [
            // --- 資料夾 1 ---
            {
                folderName: "巴斯克蛋糕",
                recipes: [
                  {
                      name: "軟心巴斯克",
                      videoId: "ZJ21nPA0uoY",
                      originalShape: "circle",
                      originalSize: 15,
                      ingredients: [
                          { name: "奶油乳酪　Cream Cheese", amount: 250, unit: "g" },
                          { name: "鮮奶油　Heavy Cream", amount: 200, unit: "ml" },
                          { name: "雞蛋　Egg", amount: 2, unit: "個" },
                          { name: "砂糖　Sugar", amount: 35, unit: "g" },
                          { name: "麵粉　Cake Flour", amount: 18, unit: "g" },
                      ]
                  },
                    {
                        name: "香蕉巴斯克",
                        videoId: "MBy4817mLnQ",
                        originalShape: "circle",
                        originalSize: 15,
                        ingredients: [
                            { name: "香蕉　Banana", amount: 200, unit: "g" },
                            { name: "茅屋起司　Cottage Cheese", amount: 250, unit: "g" },
                            { name: "無糖希臘優格　Plain Greek Yogurt", amount: 250, unit: "g" },
                            { name: "雞蛋　Egg", amount: 2, unit: "個" },
                            { name: "麵粉　Cake Flour", amount: 15, unit: "g" },
                        ]
                    },
                    {
                        name: "冰淇淋優格巴斯克",
                        videoId: "DBy8gJTfya4",
                        originalShape: "circle",
                        originalSize: 10,
                        ingredients: [
                            { name: "香草冰淇淋　Vanilla Ice Cream", amount: 150, unit: "g" },
                            { name: "希臘優格　Plain Greek Yogurt", amount: 150, unit: "g" },
                            { name: "雞蛋　Egg", amount: 1, unit: "個" }
                        ]
                    }
                ]
            },

            // --- 資料夾 2 ---
            {
                folderName: "無麩質蛋糕",
                recipes: [
                    {
                        name: "起司脆皮烤年糕",
                        videoId: "ijjsxHqn_5w",
                        originalShape: "circle",
                        originalSize: 12,
                        ingredients: [
                            { name: "雞蛋　Egg", amount: 1, unit: "個" },
                            { name: "牛奶　Milk", amount: 180, unit: "ml" },
                            { name: "蜂蜜　Honey", amount: 25, unit: "g" },
                            { name: "糯米粉　Glutinous Rice Flour", amount: 150, unit: "g" },
                            { name: "泡打粉　Baking Powder", amount: 3, unit: "g" },
                            { name: "起司片　Cheese", amount: "適量", unit: "" }
                        ]
                    },
                    {
                        name: "巧克力麻糬蛋糕",
                        videoId: "GBv-5Bdtslg",
                        originalShape: "circle",
                        originalSize: 12,
                        ingredients: [
                            { name: "可可粉　Cocoa Powder", amount: 13, unit: "g" },
                            { name: "泡打粉　Baking Powder", amount: 3, unit: "g" },
                            { name: "糯米粉　Glutinous Rice Flour", amount: 140, unit: "g" },
                            { name: "牛奶　Milk", amount: 180, unit: "ml" },
                            { name: "雞蛋　Egg", amount: 1, unit: "個" },
                            { name: "原味優格　Plain Yogurt", amount: 20, unit: "g" },
                            { name: "巧克力片　Chocolate", amount: "適量", unit: "" }
                        ]
                    },
                    {
                        name: "香蕉舒芙蕾",
                        videoId: "2yO0ZjvzL-k",
                        originalShape: "circle",
                        originalSize: 12,
                        ingredients: [
                            { name: "香蕉　Banana", amount: 100, unit: "g" },
                            { name: "雞蛋　Egg", amount: 2, unit: "個" }
                        ]
                    }
                ]
            },
        ];

        // ==========================================
        // 程式邏輯
        // ==========================================

        let currentFolderIndex = 0;
        let currentRecipeIndex = 0;
        let targetShape = 'circle';

        window.onload = function() {
            generateMenu();
            selectRecipe(0, 0);
            renderInputs();
        };

        function generateMenu() {
            const container = document.getElementById('recipe-menu-container');
            container.innerHTML = '';

            recipeData.forEach((folder, folderIdx) => {
                const folderWrapper = document.createElement('div');
                folderWrapper.className = "flex flex-col";

                const folderDiv = document.createElement('div');
                folderDiv.className = "bg-white rounded-lg border border-stone-200 overflow-hidden shadow-sm";

                const headerBtn = document.createElement('button');
                headerBtn.className = "folder-header w-full px-3 py-2 bg-stone-50 hover:bg-stone-100 flex items-center justify-between font-bold text-stone-600 text-sm transition-colors";
                headerBtn.onclick = () => toggleFolder(folderIdx);
                headerBtn.innerHTML = `
                    <span>${folder.folderName}</span>
                    <i class="fa-solid fa-chevron-down text-xs text-stone-400 transition-transform duration-300 ${folderIdx === 0 ? 'rotate-180' : ''}"></i>
                `;

                const contentDiv = document.createElement('div');
                contentDiv.id = `folder-content-${folderIdx}`;
                contentDiv.className = "folder-content bg-white border-t border-stone-100";

                if (folderIdx === 0) {
                    contentDiv.classList.add('open');
                    headerBtn.classList.add('active');
                }

                folder.recipes.forEach((recipe, recipeIdx) => {
                    const recipeBtn = document.createElement('button');
                    recipeBtn.id = `btn-recipe-${folderIdx}-${recipeIdx}`;
                    recipeBtn.onclick = () => selectRecipe(folderIdx, recipeIdx);
                    recipeBtn.className = "w-full text-left px-4 py-2 text-xs text-stone-500 hover:text-stone-800 hover:bg-stone-50 border-l-2 border-transparent transition-all flex items-center truncate";
                    recipeBtn.innerHTML = `<span class="w-1.5 h-1.5 flex-shrink-0 rounded-full bg-stone-300 mr-2"></span>${recipe.name}`;
                    contentDiv.appendChild(recipeBtn);
                });

                folderDiv.appendChild(headerBtn);
                folderDiv.appendChild(contentDiv);
                folderWrapper.appendChild(folderDiv);
                container.appendChild(folderWrapper);
            });
        }

        function toggleFolder(folderIdx) {
            const content = document.getElementById(`folder-content-${folderIdx}`);
            const header = content.previousElementSibling;
            const icon = header.querySelector('.fa-chevron-down');

            // Close others if needed, but for now we allow multiple open
            // Toggle current
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                header.classList.remove('active');
                icon.classList.remove('rotate-180');
            } else {
                content.classList.add('open');
                header.classList.add('active');
                icon.classList.add('rotate-180');
            }
        }

        function selectRecipe(folderIdx, recipeIdx) {
            currentFolderIndex = folderIdx;
            currentRecipeIndex = recipeIdx;

            document.querySelectorAll('[id^="btn-recipe-"]').forEach(btn => {
                btn.className = "w-full text-left px-4 py-2.5 text-xs text-stone-500 hover:text-stone-800 hover:bg-stone-50 border-l-2 border-transparent transition-all flex items-center truncate";
                btn.querySelector('span').classList.remove('bg-stone-600');
                btn.querySelector('span').classList.add('bg-stone-300');
            });

            const activeBtn = document.getElementById(`btn-recipe-${folderIdx}-${recipeIdx}`);
            if (activeBtn) {
                activeBtn.className = "w-full text-left px-4 py-2.5 text-xs font-bold text-stone-800 bg-stone-100 border-l-2 border-stone-500 transition-all flex items-center truncate";
                activeBtn.querySelector('span').classList.remove('bg-stone-300');
                activeBtn.querySelector('span').classList.add('bg-stone-600');
            }

            renderRecipeDisplay();
            calculate();
        }

        function renderRecipeDisplay() {
            const recipe = recipeData[currentFolderIndex].recipes[currentRecipeIndex];
            const folderName = recipeData[currentFolderIndex].folderName;

            document.getElementById('display-recipe-name').innerText = recipe.name;
            document.getElementById('display-category-name').innerText = folderName;

            const externalUrl = recipe.videoId ? `https://www.youtube.com/shorts/${recipe.videoId}` : "https://www.youtube.com";
            document.getElementById('video-link').href = externalUrl;

            const shapeText = recipe.originalShape === 'circle' ? '圓形' : '方形';
            document.getElementById('original-mold-info').innerHTML =
                `<span class="text-sm font-normal mr-1">${shapeText}</span>${recipe.originalSize}cm`;

            const listEl = document.getElementById('original-ingredient-list');
            listEl.innerHTML = '';
            recipe.ingredients.forEach(ing => {
                const amountDisplay = typeof ing.amount === 'number' ? ing.amount : ing.amount;
                listEl.innerHTML += `
                    <li class="flex justify-between items-center border-b border-stone-100 pb-1.5 last:border-0">
                        <span>${ing.name}</span>
                        <span class="font-mono font-bold text-stone-700 bg-stone-50 px-1.5 py-0.5 rounded text-xs">${amountDisplay} ${ing.unit}</span>
                    </li>
                `;
            });
        }

        function setTargetShape(shape) {
            targetShape = shape;
            const btnCircle = document.getElementById('btn-target-circle');
            const btnSquare = document.getElementById('btn-target-square');

            if (shape === 'circle') {
                btnCircle.className = "p-3 rounded-xl border-2 border-stone-400 bg-white/90 text-stone-700 font-bold transition-all flex flex-col items-center gap-1 shadow-sm ring-1 ring-stone-200";
                btnSquare.className = "p-3 rounded-xl border-2 border-transparent bg-white/50 text-stone-400 hover:bg-white/80 transition-all flex flex-col items-center gap-1";
            } else {
                btnSquare.className = "p-3 rounded-xl border-2 border-stone-400 bg-white/90 text-stone-700 font-bold transition-all flex flex-col items-center gap-1 shadow-sm ring-1 ring-stone-200";
                btnCircle.className = "p-3 rounded-xl border-2 border-transparent bg-white/50 text-stone-400 hover:bg-white/80 transition-all flex flex-col items-center gap-1";
            }
            renderInputs();
            calculate();
        }

        function renderInputs() {
            const container = document.getElementById('input-container');
            container.innerHTML = '';
            if (targetShape === 'circle') {
                container.innerHTML = `
                    <div class="relative">
                        <input type="number" id="input-d" placeholder="直徑" oninput="calculate()"
                            class="w-full p-3 pr-10 rounded-xl border border-stone-300 bg-white focus:border-stone-500 focus:ring-2 focus:ring-stone-200 outline-none text-xl font-bold text-stone-700 placeholder:text-stone-300 text-center">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-stone-400 text-sm pointer-events-none">cm</span>
                    </div>
                    <p class="text-[10px] text-stone-400 mt-2 text-center">輸入圓形模具的直徑</p>`;
            } else {
                container.innerHTML = `
                    <div class="flex gap-2">
                        <div class="relative w-1/2">
                            <input type="number" id="input-w" placeholder="長" oninput="calculate()"
                                class="w-full p-3 pr-8 rounded-xl border border-stone-300 bg-white focus:border-stone-500 focus:ring-2 focus:ring-stone-200 outline-none text-xl font-bold text-stone-700 placeholder:text-stone-300 text-center">
                             <span class="absolute right-2 top-1/2 -translate-y-1/2 text-stone-400 text-xs pointer-events-none">cm</span>
                        </div>
                        <div class="relative w-1/2">
                            <input type="number" id="input-l" placeholder="寬" oninput="calculate()"
                                class="w-full p-3 pr-8 rounded-xl border border-stone-300 bg-white focus:border-stone-500 focus:ring-2 focus:ring-stone-200 outline-none text-xl font-bold text-stone-700 placeholder:text-stone-300 text-center">
                            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-stone-400 text-xs pointer-events-none">cm</span>
                        </div>
                    </div>
                    <p class="text-[10px] text-stone-400 mt-2 text-center">輸入方形模具的邊長 (正方形模具的話長寬輸入相同數字即可)</p>`;
            }
        }

        function calculate() {
            const recipe = recipeData[currentFolderIndex].recipes[currentRecipeIndex];
            let ratio = 1.0;
            let isValid = false;

            let origArea = 0;
            if (recipe.originalShape === 'circle') {
                const origRadius = recipe.originalSize / 2;
                origArea = Math.PI * Math.pow(origRadius, 2);
            } else {
                origArea = recipe.originalSize * recipe.originalSize;
            }

            let targetArea = 0;
            if (targetShape === 'circle') {
                const d = parseFloat(document.getElementById('input-d')?.value);
                if (d && d > 0) {
                    targetArea = Math.PI * Math.pow(d/2, 2);
                    isValid = true;
                }
            } else {
                const w = parseFloat(document.getElementById('input-w')?.value);
                const l = parseFloat(document.getElementById('input-l')?.value);
                if (w && l && w > 0 && l > 0) {
                    targetArea = w * l;
                    isValid = true;
                }
            }

            if (isValid) {
                ratio = targetArea / origArea;
                document.getElementById('result-ratio').innerText = ratio.toFixed(2) + "x";
                renderConvertedIngredients(ratio);
            } else {
                document.getElementById('result-ratio').innerText = "---";
                document.getElementById('result-ingredient-list').innerHTML = '<li class="text-center text-stone-400 py-8 opacity-50 text-sm flex flex-col items-center gap-2"><i class="fa-solid fa-calculator text-2xl"></i>請輸入上方尺寸以計算</li>';
            }
        }

        function renderConvertedIngredients(ratio) {
            const recipe = recipeData[currentFolderIndex].recipes[currentRecipeIndex];
            const listEl = document.getElementById('result-ingredient-list');
            listEl.innerHTML = '';

            recipe.ingredients.forEach(ing => {
                let displayVal = "";
                if (typeof ing.amount === 'number') {
                    const rawVal = ing.amount * ratio;
                    // Smart rounding
                    if (ing.unit === '個') {
                        // Eggs usually rounded to 0.5 or 1
                        if (rawVal < 1) displayVal = rawVal.toFixed(1);
                        else displayVal = (Math.round(rawVal * 2) / 2).toFixed(1).replace('.0', '');
                    } else if (rawVal < 10) {
                        if (Math.abs(rawVal - Math.round(rawVal)) < 0.1) displayVal = Math.round(rawVal);
                        else displayVal = rawVal.toFixed(1);
                    } else {
                        displayVal = Math.round(rawVal);
                    }
                } else {
                    displayVal = ing.amount;
                }

                listEl.innerHTML += `
                    <li class="flex justify-between items-center border-b border-stone-600 pb-2 last:border-0">
                        <span class="text-stone-300">${ing.name.split('　')[0]}</span>
                        <span class="font-mono font-bold text-orange-50 text-lg">${displayVal} <span class="text-xs text-stone-400 font-normal">${ing.unit}</span></span>
                    </li>
                `;
            });
        }
    </script>
</body>
</html>


